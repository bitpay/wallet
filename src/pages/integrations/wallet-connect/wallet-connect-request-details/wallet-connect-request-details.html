<wide-header-page title="{{ 'Pending Call Request' | translate }}">
  <div page-content class="wc-container">
    <ion-list class="bp-list">
      <ion-item>
        <ion-label>
          <div class="main-label" translate>SUMMARY</div>
        </ion-label>
      </ion-item>

      <label-tip type="warn" class="no-arrowhead" *ngIf="!isSupportedMethod">
        <span label-tip-title translate>Method not supported</span>
        <div label-tip-body>
          <div translate>
           <b>{{ request?.method }}</b> is not supported by BitPay. Please check the official WalletConnect documentation to see what the supported methods are.
          </div>
          <br>
          <a class="label-tip-link" (click)="openExternalLink()" translate>Read More</a>
        </div>
      </label-tip>

      <div *ngFor="let param of request?.params; let i = index;">
          <div *ngIf="request.method === 'eth_signTypedData' || request.method === 'eth_sign' || request.method === 'eth_signTypedData_v4'">
            <ion-item *ngIf="i === 0 && param" copy-to-clipboard="{{ param }}">
              <ion-label>
                <div class="summary-item">
                  <span translate>Address</span>
                </div>
              </ion-label>
              <ion-note item-end>
                    <span class="ellipsis">{{ param | shortenedAddress }}</span>
              </ion-note>
            </ion-item>

            <div class="line-divider" *ngIf="i === 1 && param"></div>

            <ion-item *ngIf="i === 1 && param">
              <ion-label>
                <div class="summary-item">
                  <span translate>Message</span>
                </div>
              </ion-label>
              <ion-textarea disabled [value]="param"></ion-textarea>
            </ion-item>
          </div>

          <div *ngIf="request.method === 'personal_sign'">
            <ion-item *ngIf="i === 0 && param">
              <ion-label>
                <div class="summary-item">
                  <span translate>Message</span>
                </div>
              </ion-label>
              <ion-textarea disabled [value]="param"></ion-textarea>
            </ion-item>

            <div class="line-divider" *ngIf="i === 1 && param"></div>

            <ion-item *ngIf="i === 1 && param" copy-to-clipboard="{{ param }}">
              <ion-label>
                <div class="summary-item">
                  <span translate>Address</span>
                </div>
              </ion-label>
              <ion-note item-end>
                    <span class="ellipsis">{{ param | shortenedAddress }}</span>
              </ion-note>
            </ion-item>
          </div>

        </div>
        
        <div *ngIf="request?.method === 'eth_sendTransaction'">
          <label-tip type="info" class="no-arrowhead">
            <span label-tip-title translate>Give this site permission to access your token?</span>
            <div label-tip-body>
              <span translate>To complete the swap, you will need to allow the exchange ("{{ peerMeta?.name }}") to spend your {{ token?.symbol || token?.name}}.</span>
              <br>
              <span translate>By granting this permission, "{{ peerMeta?.name }}" will be able to withdraw your {{ token?.symbol || token?.name}} and complete transactions for you.</span>
            </div>
          </label-tip>
      
          <ion-list class="bp-list">
            <ion-item class="sub-title">
              <ion-label>
                <div class="main-label">Details of the transaction</div>
              </ion-label>
            </ion-item>
      
            <div class="line-divider"></div>
      
            <ion-item ion-item>
              <ion-label>
                <div class="summary-item">
                  <span translate>Token</span>
                </div>
              </ion-label>
      
              <ion-note item-end text-left>
                <ion-row align-items-center class="wallet" *ngIf="token">
                  <ion-icon class="item-img rectangle background_default" *ngIf="token.logoURI" item-start>
                    <img width="20" [src]="token.logoURI">
                  </ion-icon>
                  <ion-col>
                    <span class="note-container ellipsis">{{token.name}}</span>
                  </ion-col>
                </ion-row>
              </ion-note>
            </ion-item>
      
            <div class="line-divider"></div>
      
            <ion-item>
              <ion-label>
                <div class="summary-item">
                  <span>{{"Site URL" | translate}}</span>
                </div>
              </ion-label>
              <ion-note item-end>
                <div class="summary-item-detail">
                  <span>
                    {{ peerMeta?.url }}
                  </span>
                </div>
              </ion-note>
            </ion-item>
      
            <div class="line-divider"></div>
      
            <ion-item>
              <ion-label>
                <div class="summary-item">
                  <span>{{"Miner Fee" | translate}}</span>
                </div>
              </ion-label>
              <ion-note item-end *ngIf="ctxp?.fee"> 
                <div class="summary-item-detail">
                  <span>
                    {{ ctxp?.fee | satToUnit: wallet?.coin }}
                  </span>
                </div>
              </ion-note>
            </ion-item>
      
            <div *ngIf="fiatFee">
              <div class="secondary-note">
                <span>
                  ~{{ fiatFee | number : '1.2-3' }} {{ alternativeIsoCode }}
                </span>
              </div>
            </div>

            <div class="line-divider"></div>

            <ion-item *ngIf="params[0].data">
              <div>{{ params[0].data }}</div>
            </ion-item>
      
          </ion-list>
        </div>
      </ion-list>
      
      <div class="btn-container">
        <button  margin-top (click)="approveRequest(request)" ion-button class="button-standard" color="primary" [disabled]="!canContinue()">
          {{ buttonAction[request?.method] || 'Confirm' | translate }}
        </button>
        <button  margin-top (click)="rejectRequest(request)" ion-button class="button-standard" color="primary" outline>
          {{ 'Reject' | translate }}
        </button>
      </div>
    </div>
</wide-header-page>